<% @title = "API Docs" %>
<% @subtitle = "get your code on" %>
<p>
The API is a work in progress, and <%= link_to "can use your help!", "http://github.com/qrush/gemcutter" %> The <%= link_to "gemcutter gem", rubygem_url("gemcutter") %> uses the API to push gems, add owners, and more. Check out all of the gem commands <%= link_to "here", page_url("gem_docs") %>.
</p>

<h4>API Methods</h4>
<ul id="docs">
  <li><%= link_to "Gem Methods", "#gem" %>: Query or create rubygems to be hosted</li>
  <li><%= link_to "Owner Methods", "#owner" %>: Manage owners for gems</li>
  <li><%= link_to "Webhook Methods", "#webhook" %>: Manage notifications for when gems are pushed</li>
  <li><%= link_to "Misc Methods", "#misc" %>: Various other interactions with the site</li>
</ul>

<h4 id="gem">Gem Methods</h4>

<h5 class="api">GET - /api/v1/gems/[name].json</h5>
<p>
  Returns some basic information about the given gem. For example, here's Rails:
  <pre><code>$ curl http://gemcutter.org/api/v1/gems/rails.json

{
  "name": "rails",
  "info": "Rails is a framework for building web-application using CGI, FCGI, mod_ruby,
           or WEBrick on top of either MySQL, PostgreSQL, SQLite, DB2, SQL Server, or 
           Oracle with eRuby- or Builder-based templates.",
  "version": "2.3.5",
  "version_downloads": 2451,
  "authors": "David Heinemeier Hansson",
  "downloads": 134451,
  "project_uri": "http://gemcutter.org/gems/rails",
  "gem_uri": "http://gemcutter.org/gems/rails-2.3.5.gem"
  "runtime_dependencies": [{ "name": "activesupport", "version": "2.3.5" }],
  "development_dependencies": []
}</code></pre>
</p>

<h5 class="api">POST - /api/v1/gems</h5>
<p>
  Submit a gem to Gemcutter. Must have your API key supplied and give a built RubyGem in the body of the request.
<pre><code>$ curl --data-binary @gemcutter-0.2.1.gem \
       -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       http://gemcutter.org/api/v1/gems

Successfully registered gem: gemcutter (0.2.1)</code></pre>
</p>

<h4 id="owner">Owner Methods</h4>

<h5 class="api">GET - /api/v1/gems/[rubygem name]/owners.json</h5>
<p>
  View all owners of a gem that you own. These users can all push to this gem.
<pre><code>$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       http://gemcutter.org/api/v1/gems/gemcutter/owners.json

[
  {
    "email": "nick@gemcutter.org"
  },
  {
    "email": "ddollar@gmail.com"
  }
]
</code></pre>
</p>

<h5 class="api">POST - /api/v1/gems/[rubygem name]/owners</h5>
<p>
  Add an owner to a RubyGem you own, giving that user permission to manage it.
<pre><code>$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -F 'email=josh@technicalpickles.com' \
       http://gemcutter.org/api/v1/gems/gemcutter/owners

Owner added successfully.
</code></pre>
</p>

<h5 class="api">DELETE - /api/v1/gems/[rubygem name]/owners</h5>
<p>
  Remove a user's permission to manage a RubyGem you own.
<pre><code>$ curl -X DELETE -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
        -d "email=josh@technicalpickles.com" \
        http://gemcutter.org/api/v1/gems/gemcutter/owners

Owner removed successfully.
</code></pre>
</p>

<h4 id="webhook">WebHook Methods</h4>

<h5 class="api">GET - /api/v1/web_hooks.json</h5>
<p>
  List the webhooks registered under your account.
<pre><code>$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       http://gemcutter.org/api/v1/web_hooks.json

{
  "all gems": [
    {
      "url": "http://gemwhisperer.heroku.com",
      "failure_count": 1
    }
  ]
  "rails": [
    {
      "url": "http://example.com",
      "failure_count": 0
    }
  ]
}
</code></pre>
</p>

<h5 class="api">POST - /api/v1/web_hooks</h5>
<p>
  Create a webhook. Requires two parameters: <code>gem_name</code> and <code>url</code>. Specify <code>*</code> for the <code>gem_name</code> parameter to apply the hook globally to all gems.
<pre><code>$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -F 'gem_name=rails' -F 'url=http://example.com' \
       http://gemcutter.org/api/v1/web_hooks

Successfully created webhook for rails to http://example.com

$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -F 'gem_name=*' -F 'url=http://example.com' \
       http://gemcutter.org/api/v1/web_hooks

Successfully created webhook for all gems to http://example.com</code></pre>
</p>

<h5 class="api">DELETE - /api/v1/web_hooks/remove</h5>
<p>
  Remove a webhook. Requires two parameters: <code>gem_name</code> and <code>url</code>. Specify <code>*</code> for the <code>gem_name</code> parameter to apply the hook globally to all gems.
<pre><code>$ curl -X DELETE -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -d 'gem_name=rails' -d 'url=http://example.com' \
       http://gemcutter.org/api/v1/web_hooks/remove

Successfully removed webhook for rails to http://example.com

$ curl -X DELETE -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -d 'gem_name=*' -d 'url=http://example.com' \
       http://gemcutter.org/api/v1/web_hooks/remove

Successfully removed webhook for all gems to http://example.com</code></pre>
</p>

<h5 class="api">POST - /api/v1/web_hooks/fire</h5>
<p>
Test fire a webhook. This can be used to test out an endpoint at any time, for example when you're developing your application. Requires two parameters: <code>gem_name</code> and <code>url</code>. Specify <code>*</code> for the <code>gem_name</code> parameter to apply the hook globally to all gems.
<pre><code>$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -F 'gem_name=rails' -F 'url=http://example.com' \
       http://gemcutter.org/api/v1/web_hooks/fire

Successfully deployed webhook for rails to http://example.com

$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -F 'gem_name=*' -F 'url=http://example.com' \
       http://gemcutter.org/api/v1/web_hooks/fire

Successfully deployed webhook for all gems to http://example.com</code></pre>
</p>

<h4 id="misc">Misc Methods</h4>

<h5 class="api">GET - /api/v1/api_key</h5>
<p>
  Retrieve your API key using HTTP basic auth.
<pre><code>$ curl -u "nick@gemcutter.org:schwwwwing" \
       http://gemcutter.org/api/v1/api_key

701243f217cdf23b1370c7b66b65ca97
</code></pre>
</p>
